# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
# ESLint is a tool for identifying and reporting on patterns
# found in ECMAScript/JavaScript code.
# More details at https://github.com/eslint/eslint
# and https://eslint.org

name: ESLint

on:
    push:
        branches: ["master", dev-0.1.5]
    pull_request:
        # The branches below must be a subset of the branches above
        branches: ["master"]
    workflow_dispatch:

jobs:
    eslint:
        name: Run eslint scanning
        runs-on: ubuntu-latest
        permissions:
            contents: read
            security-events: write
            actions: read # only required for a private repository by github/codeql-action/upload-sarif to get the Action run status
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 8
                  run_install: true

            - name: Run ESLint
              run: pnpm eslint ./src --config .eslintrc.cjs --ext .js,.jsx,.ts,.tsx --format --format node_modules/eslint-formatter-markdown/markdown.js --output-file eslint-results.md
              continue-on-error: true

            - name: Get current time
              uses: josStorer/get-current-time@v2
              id: current-time
              with:
                format: YYYYMMDD-HH

            - name: Create a new GitHub Discussion
              id: create-discussion
              uses: abirismyname/create-discussion@v1.x
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              with:
                  title: ESLint checkout from ${{ github.ref }} 
                  body-filepath: eslint-results.md
                  repository-id: "special-eureka"
                  category-id: "eslint-checks"
